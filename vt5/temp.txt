
// tila
const state = {
    _state: {
        valittuKilpailu: null,
        kilpailunRastit: null,
        kilpailunSarjat: null,
        kayttajanJoukkue: null
    },
    handlers: [],
    updateState: function (valittuKilpailu) {
        Promise.all([haeRastit(valittuKilpailu),
                    haeSarjat(valittuKilpailu),
                    haeJoukkueetRajauksilla(
                        {'kilpailu':valittuKilpailu(),
                        'lisaaja':firebase.auth().currentUser.email})])
        .then(([rastit, sarjat, kayttajanJoukkueet]) => {
            this._state.valittuKilpailu = valittuKilpailu;
            this._state.kilpailunRastit = rastit;
            this._state.kilpailunSarjat = sarjat;
            this._state.kayttajanJoukkue = kayttajanJoukkueet.length > 0 ? kayttajanJoukkueet[0] : null;
            this._callHandlers();
        })
    },
    registerHandler: function(callback) {
        this.handlers.push(callback)
    },
    unregisterHandler: function(callback) {
        this.handlers = this.handlers.filter((fn) => fn != callback)
    },
    _callHandlers: function() {
        this.handlers.forEach((handler) => handler(this._state))
    }
}
